<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Modern Media Gallery</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        background: linear-gradient(
          135deg,
          #0f172a 0%,
          #1e293b 50%,
          #0f172a 100%
        );
        min-height: 100vh;
        color: #e2e8f0;
        overflow-x: hidden;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 2rem;
      }

      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
      }

      .title {
        font-size: 2.5rem;
        font-weight: 700;
        background: linear-gradient(
          135deg,
          #60a5fa 0%,
          #a78bfa 50%,
          #ec4899 100%
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .shortcuts-btn {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1.25rem;
        background: rgba(30, 41, 59, 0.8);
        border: 1px solid rgba(71, 85, 105, 0.5);
        color: #cbd5e1;
        border-radius: 0.5rem;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 0.875rem;
        font-weight: 500;
      }

      .shortcuts-btn:hover {
        background: rgba(51, 65, 85, 0.8);
        border-color: rgba(100, 116, 139, 0.5);
      }

      .shortcuts-panel {
        display: none;
        margin-bottom: 1.5rem;
        padding: 1.5rem;
        background: rgba(30, 41, 59, 0.5);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(71, 85, 105, 0.5);
        border-radius: 1rem;
      }

      .shortcuts-panel.active {
        display: block;
      }

      .shortcuts-title {
        font-size: 1.125rem;
        font-weight: 600;
        margin-bottom: 1rem;
        color: #cbd5e1;
      }

      .shortcuts-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 1rem;
      }

      .shortcut-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.875rem;
      }

      .shortcut-key {
        padding: 0.25rem 0.5rem;
        background: #0f172a;
        border: 1px solid #334155;
        border-radius: 0.25rem;
        color: #cbd5e1;
        font-family: monospace;
        font-size: 0.75rem;
      }

      .shortcut-desc {
        color: #94a3b8;
      }

      .media-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 1rem;
      }

      .thumbnail-card {
        position: relative;
        background: rgba(30, 41, 59, 0.5);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(71, 85, 105, 0.5);
        border-radius: 1rem;
        overflow: hidden;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .thumbnail-card:hover {
        transform: translateY(-4px);
        border-color: rgba(96, 165, 250, 0.5);
        box-shadow: 0 20px 25px -5px rgba(59, 130, 246, 0.2);
      }

      .thumbnail-image {
        width: 100%;
        aspect-ratio: 1;
        object-fit: cover;
        background: rgba(15, 23, 42, 0.5);
        transition: transform 0.3s;
      }

      .thumbnail-card:hover .thumbnail-image {
        transform: scale(1.1);
      }

      .thumbnail-info {
        padding: 0.75rem;
      }

      .file-name {
        font-size: 0.875rem;
        font-weight: 500;
        color: #cbd5e1;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        margin-bottom: 0.25rem;
      }

      .file-type {
        font-size: 0.75rem;
        color: #64748b;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .download-thumb-btn {
        position: absolute;
        top: 0.5rem;
        right: 0.5rem;
        width: 2rem;
        height: 2rem;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(15, 23, 42, 0.8);
        backdrop-filter: blur(10px);
        border: none;
        border-radius: 0.5rem;
        color: white;
        cursor: pointer;
        opacity: 0;
        transition: all 0.2s;
      }

      .thumbnail-card:hover .download-thumb-btn {
        opacity: 1;
      }

      .download-thumb-btn:hover {
        background: #3b82f6;
      }

      /* --- PROGRESS INDICATOR STYLES FOR MODAL THUMBNAILS --- */
      .strip-thumbnail {
        /* Existing strip-thumbnail styles */
        flex-shrink: 0;
        width: 5rem;
        height: 5rem;
        border: 2px solid rgba(71, 85, 105, 0.5);
        border-radius: 0.5rem;
        overflow: hidden;
        cursor: pointer;
        opacity: 0.5;
        transition: all 0.2s;
        position: relative; /* Must be relative for indicator positioning */
      }

      .strip-thumbnail .preload-indicator {
        position: absolute;
        inset: 0;
        display: none; /* Hidden by default */
        align-items: center;
        justify-content: center;
        background: rgba(0, 0, 0, 0.8); /* Darker overlay */
        z-index: 5;
      }

      .strip-thumbnail .preload-indicator.active {
        display: flex;
      }

      .strip-thumbnail .progress-circle {
        width: 3rem; /* Smaller circle for strip thumbnail */
        height: 3rem;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .strip-thumbnail .progress-circle svg {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        transform: rotate(-90deg);
      }

      .strip-thumbnail .progress-circle .circle-bg {
        stroke-width: 3;
        stroke: rgba(255, 255, 255, 0.2);
        fill: none;
      }

      .strip-thumbnail .progress-circle .circle-progress {
        stroke-width: 3;
        stroke: #3b82f6;
        fill: none;
        stroke-linecap: round;
        transition: stroke-dashoffset 0.3s;
      }

      .strip-thumbnail .progress-text {
        color: white;
        font-size: 0.7rem; /* Smaller text */
        font-weight: 600;
        line-height: 1;
      }
      /* --- END PROGRESS INDICATOR STYLES --- */

      .modal {
        display: none;
        position: fixed;
        inset: 0;
        z-index: 1000;
        background: rgba(0, 0, 0, 0.95);
        backdrop-filter: blur(5px);
        opacity: 0;
        transition: opacity 0.3s;
      }

      .modal.active {
        display: flex;
        opacity: 1;
      }

      .modal-container {
        display: flex;
        flex-direction: column;
        width: 100%;
        height: 100vh;
        max-height: 100vh;
        max-width: 1400px;
        margin: 0 auto;
        padding: 1rem;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-bottom: 1rem;
        flex-shrink: 0;
      }

      .modal-title-section {
        display: flex;
        align-items: center;
        gap: 1rem;
        min-width: 0;
      }

      .modal-file-name {
        font-size: 1.25rem;
        font-weight: 600;
        color: white;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .file-badge {
        padding: 0.25rem 0.75rem;
        background: rgba(30, 41, 59, 0.8);
        color: #cbd5e1;
        border-radius: 9999px;
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        white-space: nowrap;
      }

      .modal-actions {
        display: flex;
        gap: 0.5rem;
      }

      .modal-btn {
        width: 2.5rem;
        height: 2.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(30, 41, 59, 0.8);
        border: none;
        border-radius: 0.5rem;
        color: white;
        cursor: pointer;
        transition: all 0.2s;
      }

      .modal-btn:hover {
        background: rgba(51, 65, 85, 0.8);
      }

      .modal-btn.download-btn:hover {
        background: #3b82f6;
      }

      .modal-btn.close-btn:hover {
        background: #ef4444;
      }

      .modal-content-wrapper {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        min-height: 0;
        margin-bottom: 1rem;
      }

      .nav-button {
        position: absolute;
        width: 3rem;
        height: 3rem;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        border: 2px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        border-radius: 9999px;
        color: #0f172a;
        cursor: pointer;
        transition: all 0.2s;
        z-index: 10;
      }

      .nav-button:hover:not(:disabled) {
        background: rgba(255, 255, 255, 1);
        transform: scale(1.1);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
      }

      .nav-button:disabled {
        opacity: 0.3;
        cursor: not-allowed;
        background: rgba(255, 255, 255, 0.5);
      }

      .nav-button.prev {
        left: 1rem;
      }

      .nav-button.next {
        right: 1rem;
      }

      .modal-content {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        border-radius: 1rem;
      }

      .modal-content img,
      .modal-content video {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
        animation: fadeIn 0.3s;
      }

      .modal-content iframe {
        width: 100%;
        height: 100%;
        border: none;
        border-radius: 1rem;
        background: white;
      }

      .pdf-embed {
        width: 100%;
        height: 100%;
        border: none;
        border-radius: 1rem;
        background: white;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px) scale(0.98);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      .placeholder-content {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 1rem;
        text-align: center;
        padding: 2rem;
      }

      .placeholder-icon {
        width: 4rem;
        height: 4rem;
        opacity: 0.5;
      }

      .placeholder-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: white;
      }

      .placeholder-desc {
        color: #94a3b8;
        max-width: 28rem;
      }

      .placeholder-download-btn {
        margin-top: 1rem;
        padding: 0.75rem 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        background: #3b82f6;
        color: white;
        border: none;
        border-radius: 0.5rem;
        font-weight: 500;
        cursor: pointer;
        transition: background 0.2s;
      }

      .placeholder-download-btn:hover {
        background: #2563eb;
      }

      /* Text Preview Styles */
      .text-preview {
        width: 100%;
        height: 100%;
        background: #1e293b;
        border-radius: 1rem;
        padding: 2rem;
        overflow-y: auto;
        font-family: "Courier New", monospace;
        color: #e2e8f0;
        font-size: 0.875rem;
        line-height: 1.6;
        white-space: pre-wrap;
        word-wrap: break-word;
      }

      .text-preview::-webkit-scrollbar {
        width: 8px;
      }

      .text-preview::-webkit-scrollbar-track {
        background: #0f172a;
        border-radius: 4px;
      }

      .text-preview::-webkit-scrollbar-thumb {
        background: #475569;
        border-radius: 4px;
      }

      .text-preview::-webkit-scrollbar-thumb:hover {
        background: #64748b;
      }

      /* CSV Preview Styles (omitted for brevity, assume they are still here) */
      .csv-preview {
        width: 100%;
        height: 100%;
        background: #1e293b;
        border-radius: 1rem;
        padding: 1rem;
        overflow: auto;
      }

      .csv-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.875rem;
        background: #0f172a;
        border-radius: 0.5rem;
        overflow: hidden;
      }

      .csv-table thead {
        background: #334155;
        position: sticky;
        top: 0;
        z-index: 10;
      }

      .csv-table th {
        padding: 0.75rem;
        text-align: left;
        font-weight: 600;
        color: #f1f5f9;
        border-bottom: 2px solid #475569;
        white-space: nowrap;
      }

      .csv-table td {
        padding: 0.75rem;
        color: #cbd5e1;
        border-bottom: 1px solid #1e293b;
        white-space: nowrap;
      }

      .csv-table tbody tr:hover {
        background: #1e293b;
      }

      .csv-table tbody tr:nth-child(even) {
        background: rgba(30, 41, 59, 0.3);
      }

      .csv-preview::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }

      .csv-preview::-webkit-scrollbar-track {
        background: #0f172a;
        border-radius: 4px;
      }

      .csv-preview::-webkit-scrollbar-thumb {
        background: #475569;
        border-radius: 4px;
      }

      .csv-preview::-webkit-scrollbar-thumb:hover {
        background: #64748b;
      }

      .csv-info {
        padding: 0.75rem;
        margin-bottom: 1rem;
        background: rgba(59, 130, 246, 0.1);
        border: 1px solid rgba(59, 130, 246, 0.3);
        border-radius: 0.5rem;
        color: #93c5fd;
        font-size: 0.875rem;
      }

      /* Excel Preview Styles (omitted for brevity, assume they are still here) */
      .excel-preview {
        width: 100%;
        height: 100%;
        background: #1e293b;
        border-radius: 1rem;
        padding: 1rem;
        overflow: auto;
      }

      .excel-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.875rem;
        background: #0f172a;
        border-radius: 0.5rem;
        overflow: hidden;
      }

      .excel-table thead {
        background: #059669;
        position: sticky;
        top: 0;
        z-index: 10;
      }

      .excel-table th {
        padding: 0.75rem;
        text-align: left;
        font-weight: 600;
        color: #f1f5f9;
        border-bottom: 2px solid #10b981;
        white-space: nowrap;
      }

      .excel-table td {
        padding: 0.75rem;
        color: #cbd5e1;
        border-bottom: 1px solid #1e293b;
        white-space: nowrap;
      }

      .excel-table tbody tr:hover {
        background: #1e293b;
      }

      .excel-table tbody tr:nth-child(even) {
        background: rgba(30, 41, 59, 0.3);
      }

      .excel-preview::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }

      .excel-preview::-webkit-scrollbar-track {
        background: #0f172a;
        border-radius: 4px;
      }

      .excel-preview::-webkit-scrollbar-thumb {
        background: #475569;
        border-radius: 4px;
      }

      .excel-preview::-webkit-scrollbar-thumb:hover {
        background: #64748b;
      }

      .excel-info {
        padding: 0.75rem;
        margin-bottom: 1rem;
        background: rgba(5, 150, 105, 0.1);
        border: 1px solid rgba(5, 150, 105, 0.3);
        border-radius: 0.5rem;
        color: #6ee7b7;
        font-size: 0.875rem;
      }

      /* Loading Spinner for Modal Content */
      .loading-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 1rem;
        width: 100%;
        height: 100%;
      }

      .spinner {
        width: 3rem;
        height: 3rem;
        border: 4px solid rgba(255, 255, 255, 0.1);
        border-top-color: #3b82f6;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .loading-text {
        color: #94a3b8;
        font-size: 0.875rem;
      }

      .progress-bar-container {
        width: 200px;
        height: 4px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 2px;
        overflow: hidden;
      }

      .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, #3b82f6, #8b5cf6);
        border-radius: 2px;
        transition: width 0.3s ease;
      }

      .thumbnail-strip {
        display: flex;
        gap: 0.5rem;
        overflow-x: auto;
        padding: 0.5rem 1rem;
        scrollbar-width: thin;
        scrollbar-color: #475569 #0f172a;
      }

      .thumbnail-strip::-webkit-scrollbar {
        height: 8px;
      }

      .thumbnail-strip::-webkit-scrollbar-track {
        background: #0f172a;
        border-radius: 4px;
      }

      .thumbnail-strip::-webkit-scrollbar-thumb {
        background: #475569;
        border-radius: 4px;
      }

      .thumbnail-strip::-webkit-scrollbar-thumb:hover {
        background: #64748b;
      }

      /* Re-added strip-thumbnail styling for reference (moved important styles above) */
      .strip-thumbnail:hover {
        opacity: 1;
        border-color: rgba(100, 116, 139, 0.5);
      }

      .strip-thumbnail.active {
        opacity: 1;
        border-color: #3b82f6;
        transform: scale(1.1);
      }

      .strip-thumbnail img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .icon {
        width: 1.25rem;
        height: 1.25rem;
      }

      @media (max-width: 768px) {
        .title {
          font-size: 1.75rem;
        }

        .media-grid {
          grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        }

        .modal-container {
          padding: 0.5rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1 class="title">Media Gallery</h1>
        <button class="shortcuts-btn" onclick="toggleShortcuts()">
          <svg
            class="icon"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"
            ></path>
          </svg>
          Shortcuts
        </button>
      </div>

      <div class="shortcuts-panel" id="shortcutsPanel">
        <h3 class="shortcuts-title">Keyboard Shortcuts</h3>
        <div class="shortcuts-grid">
          <div class="shortcut-item">
            <span class="shortcut-key">←</span>
            <span class="shortcut-desc">Previous</span>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-key">→</span>
            <span class="shortcut-desc">Next</span>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-key">Esc</span>
            <span class="shortcut-desc">Close</span>
          </div>
          <div class="shortcut-item">
            <span class="shortcut-key">D</span>
            <span class="shortcut-desc">Download</span>
          </div>
        </div>
      </div>

      <div class="media-grid" id="mediaGrid"></div>
    </div>

    <div class="modal" id="modal" onclick="handleModalClick(event)">
      <div class="modal-container">
        <div class="modal-header">
          <div class="modal-title-section">
            <h2 class="modal-file-name" id="modalFileName">File Name</h2>
            <span class="file-badge" id="modalFileType">TYPE</span>
          </div>
          <div class="modal-actions">
            <button
              class="modal-btn download-btn"
              onclick="downloadCurrentFile()"
              title="Download (D)"
            >
              <svg
                class="icon"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"
                ></path>
              </svg>
            </button>
            <button
              class="modal-btn close-btn"
              onclick="closeModal()"
              title="Close (Esc)"
            >
              <svg
                class="icon"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M6 18L18 6M6 6l12 12"
                ></path>
              </svg>
            </button>
          </div>
        </div>

        <div class="modal-content-wrapper">
          <button class="nav-button prev" id="prevBtn" onclick="prevFile()">
            <svg
              class="icon"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M15 19l-7-7 7-7"
              ></path>
            </svg>
          </button>

          <div class="modal-content" id="modalContent"></div>

          <button class="nav-button next" id="nextBtn" onclick="nextFile()">
            <svg
              class="icon"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 5l7 7-7 7"
              ></path>
            </svg>
          </button>
        </div>

        <div class="thumbnail-strip" id="thumbnailStrip"></div>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
      var MEDIA_FILES = [
        {
          id: 1,
          type: "image",
          thumbnail:
            "https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=150&h=150&fit=crop",
          url: "https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=1200&h=800&fit=crop",
          name: "Mountain_Landscape.jpg",
        },
        {
          id: 2,
          type: "image",
          thumbnail:
            "https://images.unsplash.com/photo-1469474968028-56623f02e42e?w=150&h=150&fit=crop",
          url: "https://images.unsplash.com/photo-1469474968028-56623f02e42e?w=1200&h=800&fit=crop",
          name: "Nature_View.jpg",
        },
        {
          id: 3,
          type: "video",
          thumbnail:
            "https://images.unsplash.com/photo-1492691527719-9d1e07e534b4?w=150&h=150&fit=crop",
          url: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4",
          name: "BigBuckBunny.mp4",
        },
        {
          id: 4,
          type: "video",
          thumbnail:
            "https://images.unsplash.com/photo-1485846234645-a62644f84728?w=150&h=150&fit=crop",
          url: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4",
          name: "ElephantsDream.mp4",
        },
        {
          id: 5,
          type: "pdf",
          thumbnail: "https://cdn-icons-png.flaticon.com/512/337/337946.png",
          url: "https://pdfobject.com/pdf/sample.pdf",
          name: "Sample_Document.pdf",
        },
        {
          id: 6,
          type: "pdf",
          thumbnail: "https://cdn-icons-png.flaticon.com/512/337/337946.png",
          url: "https://www.antennahouse.com/hubfs/xsl-fo-sample/pdf/basic-link-1.pdf",
          name: "Antenna_Sample.pdf",
        },
        {
          id: 7,
          type: "excel",
          thumbnail: "https://cdn-icons-png.flaticon.com/512/732/732220.png",
          url: "media/excel_2.xlsx",
          name: "Sample_Data.xlsx",
        },
        {
          id: 8,
          type: "csv",
          thumbnail: "https://cdn-icons-png.flaticon.com/512/6133/6133884.png",
          url: "https://raw.githubusercontent.com/armgilles/194bcff35001e7eb53a2a8b441e8b2c6/raw/pokemon.csv",
          name: "Pokemon_Data.csv",
        },
        {
          id: 9,
          type: "text",
          thumbnail: "https://cdn-icons-png.flaticon.com/512/337/337932.png",
          url: "https://raw.githubusercontent.com/minimaxir/big-list-of-naughty-strings/master/blns.txt",
          name: "Sample_Text.txt",
        },
        {
          id: 10,
          type: "image",
          thumbnail:
            "https://images.unsplash.com/photo-1518837695005-2083093ee35b?w=150&h=150&fit=crop",
          url: "https://images.unsplash.com/photo-1518837695005-2083093ee35b?w=1200&h=800&fit=crop",
          name: "Ocean_Sunset.jpg",
        },
        {
          id: 11,
          type: "image",
          thumbnail:
            "https://images.unsplash.com/photo-1541963463532-d68292c34b19?w=150&h=150&fit=crop",
          url: "https://images.unsplash.com/photo-1541963463532-d68292c34b19?w=1200&h=800&fit=crop",
          name: "Book_and_Coffee.jpg",
        },
        {
          id: 12,
          type: "video",
          thumbnail:
            "https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=150&h=150&fit=crop",
          url: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerBlazes.mp4",
          name: "ForBiggerBlazes.mp4",
        },
        {
          id: 13,
          type: "csv",
          thumbnail: "https://cdn-icons-png.flaticon.com/512/6133/6133884.png",
          url: "https://raw.githubusercontent.com/datasets/gdp-life-expectancy/main/data/gdp-life-expectancy.csv",
          name: "GDP_Life_Expectancy.csv",
        },
        {
          id: 14,
          type: "text",
          thumbnail: "https://cdn-icons-png.flaticon.com/512/337/337932.png",
          url: "https://raw.githubusercontent.com/dwyl/english-words/master/words_alpha.txt",
          name: "English_Words_List.txt",
        },
        {
          id: 15,
          type: "image",
          thumbnail:
            "https://images.pexels.com/photos/17528771/pexels-photo-17528771.jpeg",
          url: "https://images.unsplash.com/photo-1505765050516-f72ce47893c0?w=1200&h=800&fit=crop",
          name: "Forest_Path.jpg",
        },
        {
          id: 16,
          type: "excel",
          thumbnail: "https://cdn-icons-png.flaticon.com/512/732/732220.png",
          // NOTE: Use a relative path assuming it's hosted on your local server.
          url: "media/excel_3.xlsx",
          name: "Project_Timeline.xlsx",
        },
        {
          id: 17,
          type: "video",
          thumbnail:
            "https://images.pexels.com/photos/34875154/pexels-photo-34875154.jpeg",
          url: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/TearsOfSteel.mp4",
          name: "TearsOfSteel.mp4",
        },
        {
          id: 18,
          type: "csv",
          thumbnail: "https://cdn-icons-png.flaticon.com/512/6133/6133884.png",
          url: "https://raw.githubusercontent.com/datasets/country-list/main/data.csv",
          name: "Country_List.csv",
        },
      ];

      var currentIndex = 0;
      var preloadedMedia = {};
      var loadingProgress = {};

      // Adjusted RADIUS for the smaller 5rem (80px) thumbnail size
      const RADIUS = 15;
      const CIRCUMFERENCE = 2 * Math.PI * RADIUS;

      /**
       * Generates the HTML for the circular progress indicator.
       */
      function renderProgressIndicatorHtml(index, progress) {
        // Use a viewBox that centers the circle and uses the calculated RADIUS
        const viewBoxSize = RADIUS * 2 + 5; // e.g., 35 for 15 radius
        const center = viewBoxSize / 2;
        var offset = CIRCUMFERENCE - ((progress || 0) / 100) * CIRCUMFERENCE;
        var activeClass =
          (progress || 0) > 0 && (progress || 0) < 100 ? " active" : "";
        var displayProgress = Math.round(progress || 0);

        return (
          '<div class="preload-indicator' +
          activeClass +
          '">' +
          '<div class="progress-circle">' +
          '<svg viewBox="0 0 ' +
          viewBoxSize +
          " " +
          viewBoxSize +
          '">' +
          '<circle class="circle-bg" cx="' +
          center +
          '" cy="' +
          center +
          '" r="' +
          RADIUS +
          '"></circle>' +
          '<circle class="circle-progress" cx="' +
          center +
          '" cy="' +
          center +
          '" r="' +
          RADIUS +
          '" stroke-dasharray="' +
          CIRCUMFERENCE +
          '" stroke-dashoffset="' +
          offset +
          '"></circle>' +
          "</svg>" +
          '<span class="progress-text">' +
          displayProgress +
          "%</span>" +
          "</div>" +
          "</div>"
        );
      }

      /**
       * Updates the visual progress indicator on the MODAL thumbnail strip.
       */
      function updateThumbnailProgress(index) {
        var progress = loadingProgress[index];
        // Target the strip thumbnail in the modal
        var card = document.querySelector(
          '#thumbnailStrip .strip-thumbnail[data-index="' + index + '"]'
        );

        if (!card) return;

        var indicator = card.querySelector(".preload-indicator");

        // If the indicator structure doesn't exist yet, it's safe to skip this,
        // as renderThumbnailStrip will add it when the modal opens.
        if (!indicator) return;

        var progressText = card.querySelector(".progress-text");
        var progressCircle = card.querySelector(".circle-progress");

        if (progress > 0 && progress < 100) {
          if (!indicator.classList.contains("active")) {
            indicator.classList.add("active");
          }

          var offset = CIRCUMFERENCE - (progress / 100) * CIRCUMFERENCE;

          if (progressCircle) {
            progressCircle.style.strokeDashoffset = offset;
          }
          if (progressText) {
            progressText.textContent = Math.round(progress) + "%";
          }
        } else {
          indicator.classList.remove("active");
        }
      }

      function preloadMedia() {
        MEDIA_FILES.forEach(function (file, index) {
          if (
            file.type === "video" ||
            file.type === "pdf" ||
            file.type === "text" ||
            file.type === "csv" ||
            file.type === "excel"
          ) {
            loadingProgress[index] = 0;

            var xhr = new XMLHttpRequest();
            xhr.open("GET", file.url, true);

            // Set response type based on file type for correct parsing
            if (file.type === "excel") {
              xhr.responseType = "arraybuffer";
            } else if (file.type === "video" || file.type === "pdf") {
              xhr.responseType = "blob";
            } else {
              xhr.responseType = "text";
            }

            xhr.onprogress = function (e) {
              if (e.lengthComputable) {
                var percent = (e.loaded / e.total) * 100;
                loadingProgress[index] = Math.min(percent, 99);
              } else {
                // If server doesn't report size, simulate progress
                if (loadingProgress[index] < 90) {
                  loadingProgress[index] += 5;
                }
              }
              // Update the visual indicator on progress
              updateThumbnailProgress(index);
            };

            xhr.onload = function () {
              if (xhr.status === 200) {
                if (file.type === "video") {
                  var blob = xhr.response;
                  var url = URL.createObjectURL(blob);
                  var video = document.createElement("video");
                  video.preload = "auto";
                  video.src = url;
                  preloadedMedia[index] = video;
                } else if (file.type === "pdf") {
                  var blob = xhr.response;
                  var url = URL.createObjectURL(blob);
                  preloadedMedia[index] = url;
                } else if (file.type === "text" || file.type === "csv") {
                  preloadedMedia[index] = xhr.responseText;
                } else if (file.type === "excel") {
                  preloadedMedia[index] = xhr.response;
                }
                loadingProgress[index] = 100;
              } else {
                // Treat loading as finished, but unsuccessful
                loadingProgress[index] = 100;
              }
              // Final update to remove indicator
              updateThumbnailProgress(index);
            };

            xhr.onerror = function () {
              loadingProgress[index] = 100;
              updateThumbnailProgress(index);
            };

            xhr.send();
          }
        });

        // Start a small interval to smooth out simulated progress
        // and catch late 100% updates for files without lengthComputable
        setInterval(function () {
          if (document.getElementById("modal").classList.contains("active")) {
            MEDIA_FILES.forEach((_, index) => {
              if (loadingProgress[index] > 0 && loadingProgress[index] < 100) {
                updateThumbnailProgress(index);
              }
            });
          }
        }, 200);
      }

      function initGrid() {
        var grid = document.getElementById("mediaGrid");
        var html = "";
        for (var i = 0; i < MEDIA_FILES.length; i++) {
          var file = MEDIA_FILES[i];
          html += '<div class="thumbnail-card" onclick="openModal(' + i + ')">';
          html +=
            '<img src="' +
            file.thumbnail +
            '" alt="' +
            file.name +
            '" class="thumbnail-image">';

          html +=
            '<button class="download-thumb-btn" onclick="event.stopPropagation(); downloadFile(' +
            i +
            ')">';
          html +=
            '<svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">';
          html +=
            '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>';
          html += "</svg>";
          html += "</button>";
          html += '<div class="thumbnail-info">';
          html += '<div class="file-name">' + file.name + "</div>";
          html += '<div class="file-type">' + file.type + "</div>";
          html += "</div>";
          html += "</div>";
        }
        grid.innerHTML = html;
      }

      function toggleShortcuts() {
        document.getElementById("shortcutsPanel").classList.toggle("active");
      }

      function openModal(index) {
        currentIndex = index;
        document.getElementById("modal").classList.add("active");
        renderThumbnailStrip();
        renderModalContent();
        updateNavButtons();
      }

      function closeModal() {
        var video = document.querySelector("#modalContent video");
        if (video) {
          video.pause();
        }
        document.getElementById("modal").classList.remove("active");
      }

      function handleModalClick(event) {
        if (event.target.id === "modal") {
          closeModal();
        }
      }

      function renderModalContent() {
        var file = MEDIA_FILES[currentIndex];
        var content = document.getElementById("modalContent");
        document.getElementById("modalFileName").textContent = file.name;
        document.getElementById("modalFileType").textContent = file.type;

        // Check for loading status first for preloaded files
        var progress = loadingProgress[currentIndex];
        if (progress > 0 && progress < 100) {
          content.innerHTML =
            '<div class="loading-container">' +
            '<div class="spinner"></div>' +
            '<p class="loading-text">Preloading ' +
            file.type.toUpperCase() +
            "... " +
            Math.round(progress) +
            "%</p>" +
            '<div class="progress-bar-container"><div class="progress-bar" style="width: ' +
            progress +
            '%"></div></div>' +
            "</div>";

          var checkInterval = setInterval(function () {
            var currentProg = loadingProgress[currentIndex] || 0;
            if (currentProg === 100) {
              clearInterval(checkInterval);
              // Re-render to show the actual content
              renderModalContent();
            } else {
              var progressText = content.querySelector(".loading-text");
              var progressBar = content.querySelector(".progress-bar");
              if (progressText)
                progressText.textContent =
                  "Preloading " +
                  file.type.toUpperCase() +
                  "... " +
                  Math.round(currentProg) +
                  "%";
              if (progressBar) progressBar.style.width = currentProg + "%";
            }
          }, 100);
          return; // Exit if file is actively preloading
        }

        if (file.type === "image") {
          content.innerHTML =
            '<div class="loading-container"><div class="spinner"></div><p class="loading-text">Loading image...</p></div>';
          var img = new Image();
          img.onload = function () {
            content.innerHTML =
              '<img src="' + file.url + '" alt="' + file.name + '">';
          };
          img.src = file.url;
        } else if (file.type === "video") {
          if (preloadedMedia[currentIndex]) {
            var video = preloadedMedia[currentIndex].cloneNode(true);
            video.controls = true;
            // video.autoplay removed as requested
            content.innerHTML = "";
            content.appendChild(video);
          } else {
            // Fallback for failed preload or very slow loading
            content.innerHTML =
              '<div class="loading-container">' +
              '<h3 class="placeholder-title">Video Not Ready</h3>' +
              '<p class="placeholder-desc">The video is not yet preloaded. You can wait a moment or try downloading it.</p>' +
              '<button class="placeholder-download-btn" onclick="downloadCurrentFile()">' +
              '<svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">' +
              '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>' +
              "</svg>" +
              " Download File" +
              "</button>" +
              "</div>";
          }
        } else if (file.type === "pdf") {
          var pdfUrl = preloadedMedia[currentIndex] || file.url;
          if (preloadedMedia[currentIndex] || !loadingProgress[currentIndex]) {
            content.innerHTML =
              '<object class="pdf-embed" data="' +
              pdfUrl +
              '#toolbar=1&navpanes=0&scrollbar=1" type="application/pdf">' +
              '<embed class="pdf-embed" src="' +
              pdfUrl +
              '#toolbar=1&navpanes=0&scrollbar=1" type="application/pdf">' +
              '<p style="color: white; text-align: center;">Your browser does not support PDF viewing. <a href="' +
              file.url +
              '" style="color: #3b82f6;" download="' +
              file.name +
              '">Download the PDF</a> instead.</p>' +
              "</embed></object>";
          }
        } else if (file.type === "text") {
          if (preloadedMedia[currentIndex]) {
            var textContent = preloadedMedia[currentIndex];
            // Limit preview to first 50000 characters for very large files
            var preview =
              textContent.length > 50000
                ? textContent.substring(0, 50000) +
                  "\n\n... (File truncated for preview. Download to see full content.)"
                : textContent;
            content.innerHTML =
              '<div class="text-preview">' + escapeHtml(preview) + "</div>";
          }
        } else if (file.type === "csv") {
          if (preloadedMedia[currentIndex]) {
            var csvContent = preloadedMedia[currentIndex];
            var tableHtml = parseCSV(csvContent);
            content.innerHTML = tableHtml;
          }
        } else if (file.type === "excel") {
          if (preloadedMedia[currentIndex]) {
            var arrayBuffer = preloadedMedia[currentIndex];
            var tableHtml = parseExcel(arrayBuffer);
            content.innerHTML = tableHtml;
          }
        } else {
          content.innerHTML =
            '<div class="placeholder-content">' +
            '<svg class="placeholder-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">' +
            '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>' +
            "</svg>" +
            '<h3 class="placeholder-title">Preview Not Available</h3>' +
            '<p class="placeholder-desc">This file type cannot be previewed directly. Click the download button to view it locally.</p>' +
            '<button class="placeholder-download-btn" onclick="downloadCurrentFile()">' +
            '<svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">' +
            '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>' +
            "</svg>" +
            " Download File" +
            "</button>" +
            "</div>";
        }
      }

      function escapeHtml(text) {
        var map = {
          "&": "&amp;",
          "<": "&lt;",
          ">": "&gt;",
          '"': "&quot;",
          "'": "&#039;",
        };
        return text.replace(/[&<>"']/g, function (m) {
          return map[m];
        });
      }

      function parseCSV(csvText) {
        var lines = csvText.split("\n");
        var rows = [];

        // Parse CSV with basic handling of quoted values
        for (var i = 0; i < lines.length; i++) {
          if (lines[i].trim() === "") continue;

          var row = [];
          var current = "";
          var inQuotes = false;

          for (var j = 0; j < lines[i].length; j++) {
            var char = lines[i][j];

            if (char === '"') {
              inQuotes = !inQuotes;
            } else if (char === "," && !inQuotes) {
              row.push(current.trim());
              current = "";
            } else {
              current += char;
            }
          }
          row.push(current.trim());
          rows.push(row);
        }

        if (rows.length === 0) {
          return '<div class="placeholder-content"><p>No data found in CSV file.</p></div>';
        }

        // Limit to first 100 rows for performance
        var maxRows = Math.min(rows.length, 100);
        var headers = rows[0];
        var truncated = rows.length > 100;

        var html = '<div class="csv-preview">';

        if (truncated) {
          html +=
            '<div class="csv-info">Showing first 100 rows of ' +
            rows.length +
            " total rows. Download file to see all data.</div>";
        }

        html += '<table class="csv-table"><thead><tr>';

        for (var h = 0; h < headers.length; h++) {
          html +=
            "<th>" + escapeHtml(headers[h].replace(/^"|"$/g, "")) + "</th>";
        }

        html += "</tr></thead><tbody>";

        for (var r = 1; r < maxRows; r++) {
          html += "<tr>";
          for (var c = 0; c < rows[r].length; c++) {
            html +=
              "<td>" + escapeHtml(rows[r][c].replace(/^"|"$/g, "")) + "</td>";
          }
          html += "</tr>";
        }

        html += "</tbody></table></div>";

        return html;
      }

      function parseExcel(arrayBuffer) {
        try {
          var workbook = XLSX.read(arrayBuffer, { type: "array" });
          var firstSheetName = workbook.SheetNames[0];
          var worksheet = workbook.Sheets[firstSheetName];
          var data = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

          if (data.length === 0) {
            return '<div class="placeholder-content"><p>No data found in Excel file.</p></div>';
          }

          // Limit to first 100 rows for performance
          var maxRows = Math.min(data.length, 100);
          var truncated = data.length > 100;

          var html = '<div class="excel-preview">';

          if (workbook.SheetNames.length > 1) {
            html +=
              '<div class="excel-info">Showing sheet: "' +
              escapeHtml(firstSheetName) +
              '" (Total sheets: ' +
              workbook.SheetNames.length +
              ")</div>";
          }

          if (truncated) {
            html +=
              '<div class="excel-info">Showing first 100 rows of ' +
              data.length +
              " total rows. Download file to see all data.</div>";
          }

          html += '<table class="excel-table"><thead><tr>';

          var headers = data[0];
          for (var h = 0; h < headers.length; h++) {
            var headerValue =
              headers[h] !== undefined && headers[h] !== null
                ? String(headers[h])
                : "";
            html += "<th>" + escapeHtml(headerValue) + "</th>";
          }

          html += "</tr></thead><tbody>";

          for (var r = 1; r < maxRows; r++) {
            html += "<tr>";
            for (var c = 0; c < data[r].length; c++) {
              var cellValue =
                data[r][c] !== undefined && data[r][c] !== null
                  ? String(data[r][c])
                  : "";
              html += "<td>" + escapeHtml(cellValue) + "</td>";
            }
            html += "</tr>";
          }

          html += "</tbody></table></div>";

          return html;
        } catch (e) {
          return (
            '<div class="placeholder-content">' +
            '<h3 class="placeholder-title">Error Reading Excel File</h3>' +
            '<p class="placeholder-desc">Unable to parse the Excel file. Please download it to view.</p>' +
            "</div>"
          );
        }
      }

      function renderThumbnailStrip() {
        var strip = document.getElementById("thumbnailStrip");
        var html = "";
        for (var i = 0; i < MEDIA_FILES.length; i++) {
          var file = MEDIA_FILES[i];
          var activeClass = i === currentIndex ? " active" : "";

          html +=
            '<div class="strip-thumbnail' +
            activeClass +
            '" data-index="' +
            i +
            '" onclick="openModal(' +
            i +
            ')">';

          html += '<img src="' + file.thumbnail + '" alt="' + file.name + '">';

          // Added the progress indicator for all pre-loadable files in the strip
          if (loadingProgress[i] !== undefined) {
            html += renderProgressIndicatorHtml(i, loadingProgress[i] || 0);
          }

          html += "</div>";
        }
        strip.innerHTML = html;

        // Initial call to update progress indicators after rendering the strip
        MEDIA_FILES.forEach((_, index) => updateThumbnailProgress(index));

        var activeThumb = strip.querySelector(".active");
        if (activeThumb) {
          activeThumb.scrollIntoView({
            behavior: "smooth",
            block: "nearest",
            inline: "center",
          });
        }
      }

      function updateNavButtons() {
        document.getElementById("prevBtn").disabled = currentIndex === 0;
        document.getElementById("nextBtn").disabled =
          currentIndex === MEDIA_FILES.length - 1;
      }

      function prevFile() {
        if (currentIndex > 0) {
          openModal(currentIndex - 1);
        }
      }

      function nextFile() {
        if (currentIndex < MEDIA_FILES.length - 1) {
          openModal(currentIndex + 1);
        }
      }

      function downloadFile(index) {
        var file = MEDIA_FILES[index];
        var link = document.createElement("a");
        link.href = file.url;
        link.download = file.name;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }

      function downloadCurrentFile() {
        downloadFile(currentIndex);
      }

      document.addEventListener("keydown", function (e) {
        if (!document.getElementById("modal").classList.contains("active")) {
          return;
        }

        switch (e.key) {
          case "ArrowLeft":
            prevFile();
            break;
          case "ArrowRight":
            nextFile();
            break;
          case "Escape":
            closeModal();
            break;
          case "d":
          case "D":
            downloadCurrentFile();
            break;
        }
      });

      initGrid();
      preloadMedia();
    </script>
  </body>
</html>
